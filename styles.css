:root {
  --bg1: #fff4fb;
  --bg2: #ffe5f2;
  --bg3: #ffd9ec;
  --card: #ffffffe6;
  --text: #503245;
  --accent: #ff8fbe;
  --btn: #ff7db1;
  --btn-strong: #ff5f9d;
  --btn-alt: #f7a5cb;
  --btn-alt-strong: #ef8aba;
  --board: #fff8fc;
  --line: #f7d6e6;
  --hairline: #ffffff;
  --soft-shadow: #ad5f8440;
  --glass-bg: #ffffff9e;
  --glass-bg-strong: #ffffffe6;
  --glass-stroke: #ffffffd9;
  --glass-shadow: #7f3a5e38;
}

@font-face {
  font-family: "PinyinUI";
  src: url("./fonts/pinyin-ui.woff2") format("woff2");
  font-weight: 400 700;
  font-style: normal;
  font-display: swap;
  unicode-range: U+0020-007E, U+00C0-00FF, U+0100-017F, U+0251, U+02C7, U+0300, U+0301, U+0304, U+030C;
}

* {
  box-sizing: border-box;
  -webkit-tap-highlight-color: transparent;
}

html,
body {
  margin: 0;
  width: 100%;
  height: 100%;
  touch-action: manipulation;
  overscroll-behavior: none;
  font-family: "Trebuchet MS", "Arial Rounded MT Bold", "PingFang SC", "Microsoft YaHei", sans-serif;
  color: var(--text);
}

body {
  background:
    radial-gradient(circle at 15% 5%, #ffffff 0%, transparent 42%),
    radial-gradient(circle at 90% 0%, #ffffffaa 0%, transparent 30%),
    linear-gradient(165deg, var(--bg1) 0%, var(--bg2) 52%, var(--bg3) 100%);
  display: flex;
  align-items: stretch;
  justify-content: center;
  padding: env(safe-area-inset-top) env(safe-area-inset-right) env(safe-area-inset-bottom) env(safe-area-inset-left);
}

.guide {
  position: fixed;
  inset: 0;
  display: flex;
  align-items: center;
  justify-content: center;
  background: #12253a8a;
  z-index: 20;
  padding: 16px;
}

.guide.hidden {
  display: none;
}

.guide-card {
  width: min(560px, 96%);
  background: #fff9fd;
  border-radius: 18px;
  border: 2px solid var(--hairline);
  box-shadow: 0 16px 38px var(--soft-shadow);
  padding: 18px;
  text-align: center;
}

.guide-card h2 {
  margin: 0 0 8px;
  font-size: clamp(24px, 5vw, 40px);
}

.guide-card p {
  margin: 6px 0;
  font-size: clamp(16px, 3vw, 22px);
}

.guide-card .btn {
  margin-top: 10px;
  min-width: 180px;
}

.app {
  width: 100%;
  max-width: 1400px;
  display: grid;
  gap: 10px;
  grid-template-rows: auto 1fr auto;
  min-height: 100%;
  padding: 8px;
}

.panel {
  background:
    linear-gradient(160deg, #ffffffd9 0%, #ffffffa6 52%, #ffdff05e 100%);
  border: 1.5px solid var(--glass-stroke);
  border-radius: 18px;
  box-shadow:
    0 14px 34px var(--glass-shadow),
    inset 0 1px 0 #ffffff;
  backdrop-filter: blur(14px) saturate(1.18);
  -webkit-backdrop-filter: blur(14px) saturate(1.18);
  padding: 12px;
}

h1 {
  margin: 0;
  font-size: clamp(24px, 5vw, 40px);
  text-align: center;
}

.tri-stack,
.tri-btn {
  display: inline-flex;
  flex-direction: column;
  align-items: center;
  gap: 2px;
}

.pinyin-text {
  font-family: "PinyinUI", "Noto Sans", "Segoe UI", sans-serif;
  font-variant-ligatures: none;
  font-feature-settings: "liga" 0, "clig" 0;
  line-height: 1.1;
  letter-spacing: 0.01em;
}

.hanzi-text {
  line-height: 1.1;
}

.en-text {
  line-height: 1.1;
  letter-spacing: 0.04em;
  font-size: 0.8em;
  opacity: 0.9;
}

.subtitle,
.hint {
  margin: 6px 0 0;
  text-align: center;
  font-size: clamp(14px, 2.8vw, 18px);
}

.stats {
  margin-top: 8px;
  display: flex;
  justify-content: center;
  gap: 14px;
  font-size: clamp(16px, 3vw, 20px);
}

.top-panel {
  padding: 4px 8px;
  display: grid;
  grid-template-columns: 1fr auto;
  grid-template-areas:
    "title title"
    "subtitle stats";
  align-items: end;
  gap: 0 8px;
}

.top-panel h1 {
  grid-area: title;
  text-align: left;
  margin: 0;
  font-size: clamp(17px, 2.2vw, 22px);
}

.top-panel .subtitle {
  grid-area: subtitle;
  margin: 0;
  text-align: left;
  font-size: clamp(11px, 1.5vw, 14px);
}

.top-panel .stats {
  grid-area: stats;
  margin: 0;
  justify-content: flex-end;
  gap: 10px;
}

.top-panel .tri-stack {
  align-items: flex-start;
  gap: 0;
}

.top-panel .pinyin-text {
  font-size: 0.5em;
}

.top-panel .hanzi-text {
  font-size: 0.72em;
}

.top-panel .en-text,
.top-panel .hint {
  display: none;
}

.stat-item {
  display: inline-flex;
  flex-direction: column;
  align-items: center;
  gap: 1px;
}

.stat-item strong {
  margin-top: 2px;
}

.game-wrap {
  display: grid;
  grid-template-columns: 1fr auto;
  gap: 10px;
  align-items: start;
  min-height: 0;
}

#game,
#next {
  background: var(--board);
  border-radius: 14px;
  border: 2px solid #ffe6f3;
  display: block;
  width: 100%;
  height: auto;
  box-shadow: inset 0 1px 0 #ffffff, 0 4px 14px #e59abe22;
}

.next-wrap {
  width: clamp(90px, 24vw, 140px);
  text-align: center;
  font-size: clamp(14px, 2.8vw, 18px);
}

.controls {
  display: grid;
  grid-template-columns: 1fr;
  gap: 8px;
  max-width: 280px;
  justify-self: end;
  align-self: start;
  padding: 6px;
  background:
    linear-gradient(160deg, #ffffffef 0%, #ffffffc2 58%, #ffd8ea80 100%);
  border: 1px solid #ffffffd8;
  box-shadow: 0 10px 24px #a85d8342, inset 0 1px 0 #ffffff;
  backdrop-filter: blur(12px) saturate(1.1);
  -webkit-backdrop-filter: blur(12px) saturate(1.1);
}

.op-controls {
  display: none;
}

.thumb-zone {
  position: relative;
  display: block;
  min-height: 0;
  padding: 8px;
  width: min(240px, 19vw);
  height: min(240px, 19vw);
}

.op-btn {
  position: absolute;
  width: min(78px, 6.3vw);
  height: min(78px, 6.3vw);
  min-height: 62px;
  font-size: clamp(18px, 2.4vw, 24px);
  border-radius: 14px;
  background:
    linear-gradient(170deg, #ffbedd 0%, #ff8fbe 46%, #ff6ca9 100%);
  box-shadow:
    0 10px 20px #ff7fb667,
    inset 0 1px 0 #ffdff0;
  padding: 0;
  transform: rotate(45deg);
  display: inline-flex;
  align-items: center;
  justify-content: center;
}

.op-icon {
  transform: rotate(-45deg);
  font-size: 1.25em;
  line-height: 1;
}

.action-rotate {
  left: 50%;
  top: 0;
  transform: translateX(-50%) rotate(45deg);
}

.action-down {
  left: 50%;
  bottom: 0;
  transform: translateX(-50%) rotate(45deg);
}

.action-left {
  left: 0;
  top: 50%;
  transform: translateY(-50%) rotate(45deg);
}

.action-right {
  right: 0;
  top: 50%;
  transform: translateY(-50%) rotate(45deg);
}

.fn-controls {
  display: grid;
  grid-template-columns: repeat(2, minmax(0, 1fr));
  gap: 8px;
  max-width: 100%;
  justify-self: end;
  align-self: start;
}

.fn-controls .btn {
  min-height: 44px;
  font-size: clamp(12px, 2.2vw, 15px);
  border-radius: 10px;
  background:
    linear-gradient(180deg, #ffe0ee 0%, #f6b8d8 55%, #ef96c3 100%);
  box-shadow:
    0 6px 14px #d57fa85e,
    inset 0 1px 0 #fff4fa;
  padding: 6px 4px;
}

.btn {
  border: 0;
  border-radius: 12px;
  min-height: 56px;
  font-size: clamp(14px, 2.8vw, 18px);
  font-weight: 700;
  color: #fff;
  background:
    linear-gradient(180deg, #ffb5d7 0%, #ff86b9 58%, var(--btn) 100%);
  box-shadow:
    0 8px 16px #ff90bf5e,
    inset 0 1px 0 #ffe8f4;
}

.btn .pinyin-text {
  font-size: 0.54em;
}

.btn .hanzi-text {
  font-size: 0.72em;
}

.btn .en-text {
  font-size: 0.5em;
}

.btn:active {
  transform: scale(0.97) translateY(1px);
  filter: saturate(1.12) brightness(0.98);
}

.btn-alt {
  background:
    linear-gradient(180deg, #ffe7f2 0%, #f8c0dc 60%, var(--btn-alt) 100%);
  box-shadow:
    0 5px 12px #dd8bb069,
    inset 0 1px 0 #fff7fb;
}

.btn:focus-visible {
  outline: 3px solid #ffffff;
  outline-offset: 1px;
}

body.kid-mode h1 {
  font-size: clamp(30px, 6vw, 48px);
}

body.kid-mode .subtitle,
body.kid-mode .hint {
  font-size: clamp(16px, 3.3vw, 22px);
}

body.kid-mode .stats {
  font-size: clamp(18px, 3.4vw, 24px);
}

body.kid-mode .btn {
  min-height: 64px;
  font-size: clamp(16px, 3.3vw, 22px);
}

body.kid-mode .fn-controls .btn {
  min-height: 48px;
  font-size: clamp(13px, 2.3vw, 16px);
}

body.kid-mode .op-btn {
  width: min(84px, 7vw);
  height: min(84px, 7vw);
  min-height: 68px;
  font-size: clamp(20px, 2.8vw, 26px);
}

body.kid-mode .btn .pinyin-text {
  font-size: 0.58em;
}

@media (orientation: landscape) {
  .app {
    grid-template-columns: minmax(170px, 20vw) minmax(0, 1fr) minmax(170px, 20vw);
    grid-template-rows: auto minmax(0, 1fr);
    height: 100%;
    padding: 8px;
  }

  .top-panel {
    grid-column: 1 / 4;
    gap: 0 6px;
    padding: 3px 8px;
  }

  .top-panel h1 {
    line-height: 1;
  }

  .top-panel .subtitle {
    white-space: nowrap;
  }

  .top-panel .stats {
    font-size: clamp(12px, 1.4vw, 15px);
    gap: 8px;
  }

  .game-wrap {
    grid-column: 2;
    grid-row: 2;
    height: 100%;
    align-items: stretch;
    grid-template-columns: minmax(0, 1fr) auto;
    padding: 8px;
  }

  #game {
    width: auto;
    height: 100%;
    max-width: 100%;
    margin: 0 auto;
  }

  .next-wrap {
    display: block;
    width: clamp(68px, 8vw, 92px);
    align-self: start;
    font-size: clamp(12px, 1.4vw, 14px);
  }

  #next {
    width: 100%;
    max-width: 92px;
    margin: 0 auto;
  }

  .controls {
    grid-column: 3;
    grid-row: 2;
    justify-self: end;
    align-self: start;
    width: min(220px, 18vw);
    background: #ffffffd6;
  }

  .thumb-zone {
    display: grid;
    background:
      linear-gradient(160deg, #ffffffe8 0%, #ffffffb5 55%, #ffd8eb80 100%);
    border: 1px solid #ffffffd9;
    border-radius: 22px;
    box-shadow: 0 12px 24px #a85d833a, inset 0 1px 0 #ffffff;
    backdrop-filter: blur(12px) saturate(1.1);
    -webkit-backdrop-filter: blur(12px) saturate(1.1);
  }

  .left-zone {
    grid-column: 1;
    grid-row: 2;
    align-self: end;
    justify-self: stretch;
    padding: 8px 10px 18px max(8px, env(safe-area-inset-left));
  }

  .right-zone {
    grid-column: 3;
    grid-row: 2;
    align-self: end;
    justify-self: stretch;
    padding: 8px max(8px, env(safe-area-inset-right)) 18px 10px;
  }

  .fn-controls {
    align-content: start;
    grid-template-columns: repeat(2, minmax(0, 1fr));
    grid-auto-rows: minmax(42px, auto);
    max-width: 100%;
    justify-self: end;
  }

  .thumb-zone {
    justify-self: center;
  }
}

@media (max-width: 520px) {
  .app {
    padding: 8px;
  }

  .controls {
    max-width: 100%;
    justify-self: stretch;
  }

  .fn-controls {
    grid-template-columns: repeat(2, minmax(0, 1fr));
  }

  .game-wrap {
    grid-template-columns: 1fr;
  }

  .next-wrap {
    width: 100%;
  }

  #next {
    max-width: 130px;
    margin: 0 auto;
  }
}
